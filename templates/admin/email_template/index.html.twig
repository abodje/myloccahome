{% extends 'base.html.twig' %}

{% block title %}Templates d'emails - Administration{% endblock %}

{% block body %}
<div class="container-fluid">
    <div class="row">
        <div class="col-md-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2>üìß Templates d'emails personnalisables</h2>
                <div class="d-flex gap-2">
                    <form method="POST" action="{{ path('app_admin_email_template_initialize') }}" class="d-inline">
                        <button type="submit" class="btn btn-info">
                            <i class="bi bi-arrow-clockwise"></i> Initialiser les templates
                        </button>
                    </form>
                    <a href="{{ path('app_admin_email_template_new') }}" class="btn btn-primary">
                        <i class="bi bi-plus-circle"></i> Nouveau template
                    </a>
                </div>
            </div>

            <!-- Statistiques -->
            <div class="row mb-4">
                <div class="col-md-3">
                    <div class="card text-center">
                        <div class="card-body">
                            <h3 class="text-primary">{{ stats.total }}</h3>
                            <small class="text-muted">Templates totaux</small>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card text-center">
                        <div class="card-body">
                            <h3 class="text-success">{{ stats.active }}</h3>
                            <small class="text-muted">Actifs</small>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card text-center">
                        <div class="card-body">
                            <h3 class="text-info">{{ stats.system }}</h3>
                            <small class="text-muted">Syst√®me</small>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card text-center">
                        <div class="card-body">
                            <h3 class="text-warning">{{ stats.custom }}</h3>
                            <small class="text-muted">Personnalis√©s</small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Templates les plus utilis√©s -->
            {% if most_used|length > 0 %}
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0"><i class="bi bi-star"></i> Templates les plus utilis√©s</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        {% for template in most_used %}
                        <div class="col-md-4">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <span>{{ template.name }}</span>
                                <span class="badge bg-primary">{{ template.usageCount }} envois</span>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- Liste des templates -->
            <div class="card">
                <div class="card-header" style="background-color: var(--primary-color); color: white;">
                    <h5 class="mb-0">Liste des templates</h5>
                </div>
                <div class="card-body p-0">
                    {% if templates|length > 0 %}
                        <div class="table-responsive">
                            <table class="table table-hover mb-0">
                                <thead>
                                    <tr>
                                        <th>Nom</th>
                                        <th>Code</th>
                                        <th>Sujet</th>
                                        <th>Type</th>
                                        <th>Utilisations</th>
                                        <th>Statut</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for template in templates %}
                                    <tr>
                                        <td>
                                            <strong>{{ template.name }}</strong>
                                            {% if template.description %}
                                                <br><small class="text-muted">{{ template.description }}</small>
                                            {% endif %}
                                        </td>
                                        <td><code>{{ template.code }}</code></td>
                                        <td>{{ template.subject|slice(0, 50) }}...</td>
                                        <td>
                                            <span class="badge bg-{{ template.isSystem ? 'info' : 'secondary' }}">
                                                {{ template.isSystem ? 'Syst√®me' : 'Personnalis√©' }}
                                            </span>
                                        </td>
                                        <td>
                                            <span class="badge bg-primary">{{ template.usageCount }}</span>
                                            {% if template.lastUsedAt %}
                                                <br><small class="text-muted">{{ template.lastUsedAt|date('d/m/Y') }}</small>
                                            {% endif %}
                                        </td>
                                        <td>
                                            <span class="badge bg-{{ template.isActive ? 'success' : 'secondary' }}">
                                                {{ template.isActive ? 'Actif' : 'Inactif' }}
                                            </span>
                                        </td>
                                        <td>
                                            <div class="btn-group btn-group-sm">
                                                <a href="{{ path('app_admin_email_template_show', {id: template.id}) }}"
                                                   class="btn btn-outline-primary" title="Voir">
                                                    <i class="bi bi-eye"></i>
                                                </a>
                                                <a href="{{ path('app_admin_email_template_edit', {id: template.id}) }}"
                                                   class="btn btn-outline-warning" title="Modifier">
                                                    <i class="bi bi-pencil"></i>
                                                </a>
                                                <form method="POST" action="{{ path('app_admin_email_template_toggle', {id: template.id}) }}" class="d-inline">
                                                    <button type="submit"
                                                            class="btn btn-outline-{{ template.isActive ? 'secondary' : 'success' }}"
                                                            title="{{ template.isActive ? 'D√©sactiver' : 'Activer' }}">
                                                        <i class="bi bi-{{ template.isActive ? 'pause' : 'play' }}-circle"></i>
                                                    </button>
                                                </form>
                                                <form method="POST" action="{{ path('app_admin_email_template_duplicate', {id: template.id}) }}" class="d-inline">
                                                    <button type="submit" class="btn btn-outline-info" title="Dupliquer">
                                                        <i class="bi bi-files"></i>
                                                    </button>
                                                </form>
                                                {% if not template.isSystem %}
                                                <form method="POST" action="{{ path('app_admin_email_template_delete', {id: template.id}) }}"
                                                      class="d-inline" onsubmit="return confirm('Confirmer la suppression ?')">
                                                    <button type="submit" class="btn btn-outline-danger" title="Supprimer">
                                                        <i class="bi bi-trash"></i>
                                                    </button>
                                                </form>
                                                {% endif %}
                                            </div>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% else %}
                        <div class="text-center p-5">
                            <i class="bi bi-envelope display-1 text-muted"></i>
                            <h5 class="mt-3 text-muted">Aucun template configur√©</h5>
                            <p class="text-muted">Cliquez sur "Initialiser" pour cr√©er les templates par d√©faut.</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
