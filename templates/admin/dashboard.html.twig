{% extends 'base.html.twig' %}

{% block title %}Administration - MYLOCCA{% endblock %}

{% block page_title %}
    <h5 class="mb-0">
        <i class="bi bi-shield-check me-2"></i>
        Panneau d'administration
    </h5>
{% endblock %}

{% block page_actions %}
    <div class="d-flex gap-2">
        <a href="{{ path('app_admin_settings') }}" class="btn btn-outline-primary btn-sm">
            <i class="bi bi-gear"></i> Paramètres
        </a>
        <a href="{{ path('app_admin_reports') }}" class="btn btn-outline-info btn-sm">
            <i class="bi bi-graph-up"></i> Rapports
        </a>
    </div>
{% endblock %}

{% block body %}
    <!-- Statistiques globales -->
    <div class="row mb-4">
        <div class="col-md-2">
            <div class="card bg-primary text-white text-center">
                <div class="card-body">
                    <i class="bi bi-house fs-1 mb-2"></i>
                    <h4>{{ stats.properties.total }}</h4>
                    <small>Propriétés</small>
                </div>
            </div>
        </div>
        <div class="col-md-2">
            <div class="card bg-success text-white text-center">
                <div class="card-body">
                    <i class="bi bi-people fs-1 mb-2"></i>
                    <h4>{{ stats.tenants.total }}</h4>
                    <small>Locataires</small>
                </div>
            </div>
        </div>
        <div class="col-md-2">
            <div class="card bg-info text-white text-center">
                <div class="card-body">
                    <i class="bi bi-file-text fs-1 mb-2"></i>
                    <h4>{{ stats.leases.active }}</h4>
                    <small>Contrats actifs</small>
                </div>
            </div>
        </div>
        <div class="col-md-2">
            <div class="card bg-warning text-white text-center">
                <div class="card-body">
                    <i class="bi bi-credit-card fs-1 mb-2"></i>
                    <h4>{{ stats.payments.pending }}</h4>
                    <small>Paiements en attente</small>
                </div>
            </div>
        </div>
        <div class="col-md-2">
            <div class="card bg-danger text-white text-center">
                <div class="card-body">
                    <i class="bi bi-tools fs-1 mb-2"></i>
                    <h4>{{ stats.maintenance.pending }}</h4>
                    <small>Maintenances</small>
                </div>
            </div>
        </div>
        <div class="col-md-2">
            <div class="card bg-secondary text-white text-center">
                <div class="card-body">
                    <i class="bi bi-file-earmark fs-1 mb-2"></i>
                    <h4>{{ stats.documents.total }}</h4>
                    <small>Documents</small>
                </div>
            </div>
        </div>
    </div>

    <!-- Actions d'administration -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card h-100">
                <div class="card-body text-center">
                    <i class="bi bi-people display-4 text-primary mb-3"></i>
                    <h6>Gestion des locataires</h6>
                    <p class="text-muted small">Gérer tous les locataires</p>
                    <a href="{{ path('app_tenant_index') }}" class="btn btn-outline-primary btn-sm">
                        Accéder
                    </a>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card h-100">
                <div class="card-body text-center">
                    <i class="bi bi-gear display-4 text-secondary mb-3"></i>
                    <h6>Paramètres système</h6>
                    <p class="text-muted small">Configuration de l'application</p>
                    <a href="{{ path('app_admin_settings') }}" class="btn btn-outline-secondary btn-sm">
                        Configurer
                    </a>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card h-100">
                <div class="card-body text-center">
                    <i class="bi bi-graph-up display-4 text-info mb-3"></i>
                    <h6>Rapports</h6>
                    <p class="text-muted small">Statistiques et analyses</p>
                    <a href="{{ path('app_admin_reports') }}" class="btn btn-outline-info btn-sm">
                        Voir
                    </a>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card h-100">
                <div class="card-body text-center">
                    <i class="bi bi-wrench display-4 text-warning mb-3"></i>
                    <h6>Maintenance système</h6>
                    <p class="text-muted small">Outils de maintenance</p>
                    <a href="{{ path('app_admin_maintenance') }}" class="btn btn-outline-warning btn-sm">
                        Accéder
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Activité récente -->
    <div class="row">
        <div class="col-lg-6">
            <!-- Alertes système -->
            {% if activity.overdue_payments|length > 0 %}
                <div class="card mb-4">
                    <div class="card-header bg-danger text-white">
                        <h6 class="mb-0">
                            <i class="bi bi-exclamation-triangle me-2"></i>
                            Paiements en retard ({{ activity.overdue_payments|length }})
                        </h6>
                    </div>
                    <div class="card-body p-0">
                        {% for payment in activity.overdue_payments|slice(0, 5) %}
                            <div class="d-flex justify-content-between align-items-center p-3 border-bottom">
                                <div>
                                    <h6 class="mb-1">{{ payment.lease.tenant.fullName }}</h6>
                                    <small class="text-muted">
                                        {{ payment.type }} - {{ payment.amount|currency }} -
                                        {{ payment.daysOverdue }} jours de retard
                                    </small>
                                </div>
                                <a href="{{ path('app_payment_show', {id: payment.id}) }}"
                                   class="btn btn-sm btn-outline-primary">
                                    Voir
                                </a>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            {% endif %}

            <!-- Nouveaux locataires -->
            <div class="card">
                <div class="card-header">
                    <h6 class="mb-0">
                        <i class="bi bi-person-plus me-2"></i>
                        Nouveaux locataires
                    </h6>
                </div>
                <div class="card-body p-0">
                    {% if activity.new_tenants|length > 0 %}
                        {% for tenant in activity.new_tenants %}
                            <div class="d-flex justify-content-between align-items-center p-3 border-bottom">
                                <div>
                                    <h6 class="mb-1">{{ tenant.fullName }}</h6>
                                    <small class="text-muted">
                                        {{ tenant.email }} - {{ tenant.createdAt|date('d/m/Y H:i') }}
                                    </small>
                                </div>
                                <a href="{{ path('app_tenant_show', {id: tenant.id}) }}"
                                   class="btn btn-sm btn-outline-primary">
                                    Voir
                                </a>
                            </div>
                        {% endfor %}
                    {% else %}
                        <div class="p-3 text-center text-muted">
                            Aucun nouveau locataire récemment
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <div class="col-lg-6">
            <!-- Demandes de maintenance récentes -->
            <div class="card mb-4">
                <div class="card-header">
                    <h6 class="mb-0">
                        <i class="bi bi-tools me-2"></i>
                        Demandes de maintenance récentes
                    </h6>
                </div>
                <div class="card-body p-0">
                    {% if activity.recent_maintenance|length > 0 %}
                        {% for request in activity.recent_maintenance %}
                            <div class="d-flex justify-content-between align-items-center p-3 border-bottom">
                                <div>
                                    <h6 class="mb-1">{{ request.title }}</h6>
                                    <small class="text-muted">
                                        {{ request.category }} - {{ request.createdAt|date('d/m/Y H:i') }}
                                    </small>
                                </div>
                                <div class="text-end">
                                    <span class="badge bg-{{ request.statusColor }}">{{ request.status }}</span>
                                    {% if request.priority == 'Urgente' %}
                                        <br><span class="badge bg-danger mt-1">Urgent</span>
                                    {% endif %}
                                </div>
                            </div>
                        {% endfor %}
                    {% else %}
                        <div class="p-3 text-center text-muted">
                            Aucune demande récente
                        </div>
                    {% endif %}
                </div>
            </div>

            <!-- Actions rapides admin -->
            <div class="card">
                <div class="card-header">
                    <h6 class="mb-0">
                        <i class="bi bi-lightning me-2"></i>
                        Actions rapides
                    </h6>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <a href="{{ path('app_tenant_new') }}" class="btn btn-success">
                            <i class="bi bi-person-plus me-2"></i>
                            Nouveau locataire
                        </a>
                        <a href="{{ path('app_property_new') }}" class="btn btn-primary">
                            <i class="bi bi-house-add me-2"></i>
                            Nouvelle propriété
                        </a>
                        <a href="{{ path('app_admin_maintenance') }}" class="btn btn-warning">
                            <i class="bi bi-wrench me-2"></i>
                            Maintenance système
                        </a>
                        <a href="{{ path('app_admin_logs') }}" class="btn btn-outline-secondary">
                            <i class="bi bi-journal-text me-2"></i>
                            Consulter les logs
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
