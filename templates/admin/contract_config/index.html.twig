{% extends 'base.html.twig' %}

{% block title %}Configuration des contrats - MYLOCCA{% endblock %}

{% block page_title %}
    <h5 class="mb-0">
        <i class="bi bi-file-earmark-text me-2"></i>
        Configuration des contrats PDF
    </h5>
{% endblock %}

{% block page_actions %}
    <div class="btn-group">
        <a href="{{ path('app_admin_contract_config_preview') }}" class="btn btn-info btn-sm" target="_blank">
            <i class="bi bi-eye"></i> Aper√ßu
        </a>
        <form method="POST" action="{{ path('app_admin_contract_config_reset') }}" class="d-inline">
            <button type="submit" class="btn btn-warning btn-sm" onclick="return confirm('R√©initialiser la configuration ?')">
                <i class="bi bi-arrow-clockwise"></i> Reset
            </button>
        </form>
    </div>
{% endblock %}

{% block body %}
    <div class="row">
        <div class="col-md-12">
            <div class="card">
                <div class="card-header">
                    <h6 class="mb-0">Param√®tres du contrat de bail</h6>
                </div>
                <div class="card-body">
                    <form method="POST">
                        <!-- Th√®mes pr√©d√©finis -->
                        <div class="mb-4">
                            <h6>üé® Th√®mes pr√©d√©finis</h6>
                            <div class="d-flex gap-2 flex-wrap">
                                {% for themeKey, theme in themes %}
                                    <form method="POST" action="{{ path('app_admin_contract_config_theme', {themeName: themeKey}) }}" class="d-inline">
                                        <button type="submit" class="btn btn-outline-primary btn-sm">
                                            <span class="color-preview" style="background-color: {{ theme.contract_primary_color }}; width: 16px; height: 16px; display: inline-block; border-radius: 3px; margin-right: 5px;"></span>
                                            {{ theme.name }}
                                        </button>
                                    </form>
                                {% endfor %}
                            </div>
                        </div>

                        <hr>

                        <!-- Apparence g√©n√©rale -->
                        <div class="row">
                            <div class="col-md-6">
                                <h6>üìù Apparence g√©n√©rale</h6>
                                
                                <div class="mb-3">
                                    <label class="form-label">Langue</label>
                                    <select name="contract_language" class="form-select">
                                        <option value="fr" {{ config.contract_language == 'fr' ? 'selected' : '' }}>Fran√ßais</option>
                                        <option value="en" {{ config.contract_language == 'en' ? 'selected' : '' }}>English</option>
                                    </select>
                                </div>

                                <div class="mb-3">
                                    <label class="form-label">Titre principal</label>
                                    <input type="text" name="contract_main_title" class="form-control" 
                                           value="{{ config.contract_main_title }}">
                                </div>

                                <div class="mb-3">
                                    <label class="form-label">Police</label>
                                    <select name="contract_font_family" class="form-select">
                                        <option value="DejaVu Sans, sans-serif" {{ config.contract_font_family == 'DejaVu Sans, sans-serif' ? 'selected' : '' }}>DejaVu Sans</option>
                                        <option value="Arial, sans-serif" {{ config.contract_font_family == 'Arial, sans-serif' ? 'selected' : '' }}>Arial</option>
                                        <option value="Times New Roman, serif" {{ config.contract_font_family == 'Times New Roman, serif' ? 'selected' : '' }}>Times New Roman</option>
                                    </select>
                                </div>

                                <div class="mb-3">
                                    <label class="form-label">Taille de police</label>
                                    <input type="text" name="contract_font_size" class="form-control" 
                                           value="{{ config.contract_font_size }}" placeholder="11pt">
                                </div>
                            </div>

                            <div class="col-md-6">
                                <h6>üé® Couleurs</h6>
                                
                                <div class="mb-3">
                                    <label class="form-label">Couleur principale</label>
                                    <div class="input-group">
                                        <input type="color" name="contract_primary_color" class="form-control form-control-color" 
                                               value="{{ config.contract_primary_color }}">
                                        <input type="text" class="form-control" value="{{ config.contract_primary_color }}">
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label class="form-label">Couleur du texte</label>
                                    <div class="input-group">
                                        <input type="color" name="contract_text_color" class="form-control form-control-color" 
                                               value="{{ config.contract_text_color }}">
                                        <input type="text" class="form-control" value="{{ config.contract_text_color }}">
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label class="form-label">Couleur de fond des infos</label>
                                    <div class="input-group">
                                        <input type="color" name="contract_info_bg_color" class="form-control form-control-color" 
                                               value="{{ config.contract_info_bg_color }}">
                                        <input type="text" class="form-control" value="{{ config.contract_info_bg_color }}">
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label class="form-label">Couleur de surbrillance</label>
                                    <div class="input-group">
                                        <input type="color" name="contract_highlight_color" class="form-control form-control-color" 
                                               value="{{ config.contract_highlight_color }}">
                                        <input type="text" class="form-control" value="{{ config.contract_highlight_color }}">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <hr>

                        <!-- Informations entreprise -->
                        <div class="row">
                            <div class="col-md-6">
                                <h6>üè¢ Informations entreprise</h6>
                                
                                <div class="mb-3">
                                    <label class="form-label">Nom de l'entreprise</label>
                                    <input type="text" name="contract_company_name" class="form-control" 
                                           value="{{ config.contract_company_name }}">
                                </div>

                                <div class="mb-3">
                                    <label class="form-label">Adresse</label>
                                    <textarea name="contract_company_address" class="form-control" rows="3">{{ config.contract_company_address }}</textarea>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <h6>üñºÔ∏è Logo</h6>
                                
                                <div class="mb-3">
                                    <label class="form-label">URL du logo</label>
                                    <input type="url" name="contract_logo_url" class="form-control" 
                                           value="{{ config.contract_logo_url }}" placeholder="https://...">
                                    <div class="form-text">URL compl√®te vers l'image du logo</div>
                                </div>

                                {% if config.contract_logo_url %}
                                    <div class="mb-3">
                                        <label class="form-label">Aper√ßu du logo</label>
                                        <div>
                                            <img src="{{ config.contract_logo_url }}" alt="Logo" style="max-height: 60px;" class="border">
                                        </div>
                                    </div>
                                {% endif %}
                            </div>
                        </div>

                        <hr>

                        <!-- Titres des sections -->
                        <div class="row">
                            <div class="col-md-6">
                                <h6>üìã Titres des sections</h6>
                                
                                <div class="mb-3">
                                    <label class="form-label">Article 1 - Les parties</label>
                                    <input type="text" name="contract_section_1_title" class="form-control" 
                                           value="{{ config.contract_section_1_title }}">
                                </div>

                                <div class="mb-3">
                                    <label class="form-label">Article 2 - Le bien lou√©</label>
                                    <input type="text" name="contract_section_2_title" class="form-control" 
                                           value="{{ config.contract_section_2_title }}">
                                </div>

                                <div class="mb-3">
                                    <label class="form-label">Article 3 - Dur√©e du bail</label>
                                    <input type="text" name="contract_section_3_title" class="form-control" 
                                           value="{{ config.contract_section_3_title }}">
                                </div>

                                <div class="mb-3">
                                    <label class="form-label">Article 4 - Loyer et charges</label>
                                    <input type="text" name="contract_section_4_title" class="form-control" 
                                           value="{{ config.contract_section_4_title }}">
                                </div>
                            </div>

                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Article 5 - D√©p√¥t de garantie</label>
                                    <input type="text" name="contract_section_5_title" class="form-control" 
                                           value="{{ config.contract_section_5_title }}">
                                </div>

                                <div class="mb-3">
                                    <label class="form-label">Article 6 - Obligations locataire</label>
                                    <input type="text" name="contract_section_6_title" class="form-control" 
                                           value="{{ config.contract_section_6_title }}">
                                </div>

                                <div class="mb-3">
                                    <label class="form-label">Article 7 - Obligations bailleur</label>
                                    <input type="text" name="contract_section_7_title" class="form-control" 
                                           value="{{ config.contract_section_7_title }}">
                                </div>

                                <div class="mb-3">
                                    <label class="form-label">Article 8 - Clause r√©solutoire</label>
                                    <input type="text" name="contract_section_8_title" class="form-control" 
                                           value="{{ config.contract_section_8_title }}">
                                </div>
                            </div>
                        </div>

                        <hr>

                        <!-- Signatures -->
                        <div class="row">
                            <div class="col-md-6">
                                <h6>‚úçÔ∏è Signatures</h6>
                                
                                <div class="mb-3">
                                    <label class="form-label">Titre bailleur</label>
                                    <input type="text" name="contract_signature_landlord_title" class="form-control" 
                                           value="{{ config.contract_signature_landlord_title }}">
                                </div>

                                <div class="mb-3">
                                    <label class="form-label">Titre locataire</label>
                                    <input type="text" name="contract_signature_tenant_title" class="form-control" 
                                           value="{{ config.contract_signature_tenant_title }}">
                                </div>

                                <div class="mb-3">
                                    <label class="form-label">Lieu de signature</label>
                                    <input type="text" name="contract_signature_place" class="form-control" 
                                           value="{{ config.contract_signature_place }}">
                                </div>
                            </div>

                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Texte signature bailleur</label>
                                    <input type="text" name="contract_signature_landlord_text" class="form-control" 
                                           value="{{ config.contract_signature_landlord_text }}">
                                </div>

                                <div class="mb-3">
                                    <label class="form-label">Texte signature locataire</label>
                                    <input type="text" name="contract_signature_tenant_text" class="form-control" 
                                           value="{{ config.contract_signature_tenant_text }}">
                                </div>

                                <div class="mb-3">
                                    <label class="form-label">Texte du footer</label>
                                    <input type="text" name="contract_footer_text" class="form-control" 
                                           value="{{ config.contract_footer_text }}">
                                </div>
                            </div>
                        </div>

                        <div class="d-flex gap-2 mt-4">
                            <button type="submit" class="btn btn-primary">
                                <i class="bi bi-check-circle"></i> Sauvegarder
                            </button>
                            <a href="{{ path('app_admin_contract_config_preview') }}" class="btn btn-info" target="_blank">
                                <i class="bi bi-eye"></i> Aper√ßu
                            </a>
                        </div>
                    </form>
                </div>
            </div>

            <div class="card mt-3">
                <div class="card-header">
                    <h6 class="mb-0">üí° Aide</h6>
                </div>
                <div class="card-body">
                    <h6>Variables disponibles dans les contrats</h6>
                    <ul class="small">
                        <li><code>{{ '{{lease.id}}' }}</code> - ID du bail</li>
                        <li><code>{{ '{{tenant.firstName}}' }}</code> - Pr√©nom du locataire</li>
                        <li><code>{{ '{{tenant.lastName}}' }}</code> - Nom du locataire</li>
                        <li><code>{{ '{{property.address}}' }}</code> - Adresse du bien</li>
                        <li><code>{{ '{{lease.monthlyRent|currency}}' }}</code> - Loyer format√©</li>
                        <li><code>{{ '{{generated_at|date}}' }}</code> - Date de g√©n√©ration</li>
                    </ul>
                    
                    <h6 class="mt-3">Format des couleurs</h6>
                    <p class="small">Utilisez le format hexad√©cimal : <code>#RRGGBB</code> (ex: #0066cc)</p>
                    
                    <h6 class="mt-3">Format des tailles</h6>
                    <p class="small">Utilisez le format : <code>XXpt</code> (ex: 11pt, 24pt)</p>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script>
        // Synchroniser les couleurs entre les inputs color et text
        document.addEventListener('DOMContentLoaded', function() {
            const colorInputs = document.querySelectorAll('input[type="color"]');
            colorInputs.forEach(colorInput => {
                const textInput = colorInput.parentNode.querySelector('input[type="text"]');
                if (textInput) {
                    colorInput.addEventListener('input', function() {
                        textInput.value = this.value;
                    });
                    textInput.addEventListener('input', function() {
                        if (/^#[0-9A-Fa-f]{6}$/.test(this.value)) {
                            colorInput.value = this.value;
                        }
                    });
                }
            });
        });
    </script>
{% endblock %}
