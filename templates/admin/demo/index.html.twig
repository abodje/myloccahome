{% extends 'base.html.twig' %}

{% block title %}Gestion Environnements de D√©mo - Administration{% endblock %}

{% block body %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <div>
                    <h1 class="h3 mb-0">üåê Environnements de D√©mo</h1>
                    <p class="text-muted mb-0">G√©rez les environnements de d√©mo avec sous-domaines</p>
                </div>
                <div>
                    <span class="badge bg-primary fs-6">Super Administration</span>
                </div>
            </div>

            {% for message in app.flashes('success') %}
                <div class="alert alert-success alert-dismissible fade show" role="alert">
                    <i class="bi bi-check-circle me-2"></i>{{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            {% endfor %}

            {% for message in app.flashes('error') %}
                <div class="alert alert-danger alert-dismissible fade show" role="alert">
                    <i class="bi bi-exclamation-triangle me-2"></i>{{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            {% endfor %}

            {% for message in app.flashes('warning') %}
                <div class="alert alert-warning alert-dismissible fade show" role="alert">
                    <i class="bi bi-exclamation-triangle me-2"></i>{{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            {% endfor %}

            <!-- Cr√©er un nouvel environnement -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="card border-0 shadow-sm">
                        <div class="card-header bg-success text-white">
                            <h5 class="card-title mb-0">
                                <i class="bi bi-plus-circle me-2"></i>Cr√©er un Nouvel Environnement de D√©mo
                            </h5>
                        </div>
                        <div class="card-body">
                            <form method="POST" action="{{ path('app_admin_demo_create') }}">
                                <div class="row">
                                    <div class="col-md-4">
                                        <div class="mb-3">
                                            <label for="email" class="form-label">Email</label>
                                            <input type="email" class="form-control" id="email" name="email" required>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="mb-3">
                                            <label for="first_name" class="form-label">Pr√©nom</label>
                                            <input type="text" class="form-control" id="first_name" name="first_name" required>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="mb-3">
                                            <label for="last_name" class="form-label">Nom</label>
                                            <input type="text" class="form-control" id="last_name" name="last_name" required>
                                        </div>
                                    </div>
                                </div>
                                <div class="d-flex justify-content-end">
                                    <button type="submit" class="btn btn-success">
                                        <i class="bi bi-plus-circle me-2"></i>Cr√©er l'Environnement de D√©mo
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Liste des environnements existants -->
            <div class="row">
                <div class="col-12">
                    <div class="card border-0 shadow-sm">
                        <div class="card-header bg-primary text-white">
                            <h5 class="card-title mb-0">
                                <i class="bi bi-list me-2"></i>Environnements de D√©mo Actifs
                            </h5>
                        </div>
                        <div class="card-body">
                            {% if environments is empty %}
                                <div class="text-center py-5">
                                    <i class="bi bi-inbox display-1 text-muted"></i>
                                    <h4 class="text-muted mt-3">Aucun environnement de d√©mo</h4>
                                    <p class="text-muted">Cr√©ez votre premier environnement de d√©mo ci-dessus.</p>
                                </div>
                            {% else %}
                                <div class="table-responsive">
                                    <table class="table table-hover">
                                        <thead>
                                            <tr>
                                                <th>Sous-domaine</th>
                                                <th>Nom</th>
                                                <th>URL de D√©mo</th>
                                                <th>Statut</th>
                                                <th>Cr√©√© le</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for env in environments %}
                                                <tr>
                                                    <td>
                                                        <span class="badge bg-info">{{ env.subdomain }}</span>
                                                    </td>
                                                    <td>{{ env.name }}</td>
                                                    <td>
                                                        <a href="{{ env.demo_url }}" target="_blank" class="text-decoration-none">
                                                            <i class="bi bi-box-arrow-up-right me-1"></i>{{ env.demo_url }}
                                                        </a>
                                                    </td>
                                                    <td>
                                                        {% if env.status == 'active' %}
                                                            <span class="badge bg-success">Actif</span>
                                                        {% else %}
                                                            <span class="badge bg-warning">{{ env.status|title }}</span>
                                                        {% endif %}
                                                    </td>
                                                    <td>{{ env.created_at|date('d/m/Y H:i') }}</td>
                                                    <td>
                                                        <div class="btn-group" role="group">
                                                            <a href="{{ env.demo_url }}" target="_blank" class="btn btn-sm btn-outline-primary" title="Ouvrir">
                                                                <i class="bi bi-eye"></i>
                                                            </a>
                                                            <form method="POST" action="{{ path('app_admin_demo_refresh', {'subdomain': env.subdomain}) }}" class="d-inline">
                                                                <button type="submit" class="btn btn-sm btn-outline-warning" title="Rafra√Æchir" onclick="return confirm('√ätes-vous s√ªr de vouloir rafra√Æchir cet environnement ?')">
                                                                    <i class="bi bi-arrow-clockwise"></i>
                                                                </button>
                                                            </form>
                                                            <form method="POST" action="{{ path('app_admin_demo_delete', {'subdomain': env.subdomain}) }}" class="d-inline">
                                                                <button type="submit" class="btn btn-sm btn-outline-danger" title="Supprimer" onclick="return confirm('√ätes-vous s√ªr de vouloir supprimer cet environnement ?')">
                                                                    <i class="bi bi-trash"></i>
                                                                </button>
                                                            </form>
                                                        </div>
                                                    </td>
                                                </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Informations techniques -->
            <div class="row mt-4">
                <div class="col-12">
                    <div class="alert alert-info border-0">
                        <div class="d-flex align-items-start">
                            <i class="bi bi-info-circle fs-4 me-3"></i>
                            <div>
                                <h6 class="alert-heading mb-2">üí° Informations Techniques</h6>
                                <ul class="mb-0 small">
                                    <li><strong>Sous-domaines :</strong> Chaque environnement g√©n√®re un sous-domaine unique</li>
                                    <li><strong>Donn√©es de d√©mo :</strong> 5 propri√©t√©s, 5 locataires, 4 baux, 12 paiements</li>
                                    <li><strong>Configuration Apache :</strong> Fichiers de configuration g√©n√©r√©s automatiquement</li>
                                    <li><strong>DNS Local :</strong> Entr√©es ajout√©es au fichier hosts Windows</li>
                                    <li><strong>Isolation :</strong> Chaque environnement est compl√®tement isol√©</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
